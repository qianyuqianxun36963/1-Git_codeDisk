<!DOCTYPE html>
<html>
  <head>
    <title>import_Excel.html</title>
    
    <meta name="keywords" content="keyword1,keyword2,keyword3">
    <meta name="description" content="this is my page">
    <meta name="content-type" content="text/html; charset=UTF-8"><!-- 仅仅是标示信息 -->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><!-- 不仅是标示，还会产生效果 -->
    
    <!-- bootstrap样式 -->
    <link href="../Modules/Library/metronic-4.7/assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../Modules/Library/metronic-4.7/assets/global/plugins/bootstrap-fileinput/bootstrap-fileinput.css" rel="stylesheet" type="text/css" />
    <!-- 弹出框样式 -->
    <link href="../Modules/Library/sweetalert/css/sweetalert.css" rel="stylesheet" type="text/css" />
    
    <!-- jquery脚本 -->
    <script src="../Modules/Library/jquery/jquery-2.1.1.min.js" type="text/javascript"></script>
    <script src="../Modules/Library/jquery/jquery.form.js" type="text/javascript"></script>
    <!-- bootstrap脚本 -->
    <script src="../Modules/Library/metronic-4.7/assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="../Modules/Library/metronic-4.7/assets/global/plugins/bootstrap-fileinput/bootstrap-fileinput.js" type="text/javascript"></script>
    <!-- 弹出框脚本 -->
    <script src="../Modules/Library/sweetalert/js/sweetalert.min.js" type="text/javascript"></script>
    <script src="../Modules/Library/sweetalert/js/showAlert.js" type="text/javascript"></script>
    
  </head>
    
  <body>
    <h2>导入excel的测试页面 </h2>
    
    <button class='btn green' type="button" style='float:left;margin-left:15px;'  data-toggle="modal" onclick ="showImportModal();">导入发票</button>
    
    <!-- 导入模态框 -->
    <div id="importModal" class="modal fade" role="dialog" aria-hidden="true" >
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                    <h4 class="modal-title">批量上传</h4>
                </div>
                <div class="modal-body form">
                    <form id="importForm" action="#" class="form-horizontal form-row-seperated" enctype="multipart/form-data">
                        <div class="form-group">
                            <label class="col-sm-3 control-label">下载模板：</label>
                            <button class='btn green' type="button" style='float:left;margin-left:15px;' onclick="downloadTemplate()">下载</button>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">上传文件：</label>
                            <div class="col-md-4" id="importFile">
                                  <div class="fileinput fileinput-new" data-provides="fileinput">
                                      <span class="btn green btn-file">
                                          <span class="fileinput-new"> 选择导入文件 </span>
                                          <span class="fileinput-exists"> 更换 </span>
                                          <input type="file" name="file" id="selectedFile" accept="application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" class="required" > </span>
                                      <span class="fileinput-filename"> </span> &nbsp;
                                      <a href="javascript:;" class="close fileinput-exists" data-dismiss="fileinput"> </a>
                                  </div>
                             </div>
                        </div>
                    </form>    
                    <form id="downloadTemplateForm" method="POST" style="display:none"></form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn grey-salsa btn-outline" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn green ajaxButton" onclick="uploadInvoiceFile()">上传</button>
                </div>
            </div>
        </div>
    </div>
    
  </body>
  
  <script type="text/javascript">
  
  //显示导入模态框
  function showImportModal(){
      $("#importModal").modal('show');
  }
  
  //下载导入模板
  function downloadTemplate(){
      var url = encodeURI( "/MyWeb_8_Func_excel/excel/downloadImportTemplate?fileName=invoiceImportTemplate.xlsx");
      $("#downloadTemplateForm").attr('action',url);
      $("#downloadTemplateForm").attr('target','');
      $("#downloadTemplateForm").submit();
  }
  

//导入发票信息
function uploadInvoiceFile(){
    debugger;
    //采用formdata进行ajax请求上传文件 ie10以上
    var fileName = $("#selectedFile").val();
    if(fileName == null || fileName == ""){
        showInfoModal("请选择导入文件");
        return;
    }
    var subfix = fileName.lastIndexOf(".");
    if(fileName.substr(subfix) != ".xls" && fileName.substr(subfix) != ".xlsx"){
        showInfoModal("请选择excel文件");
        return;
    }
    
    //ajaxSubmit方式提交请求
    $("#importForm").ajaxSubmit({
        url: "/MyWeb_8_Func_excel/excel/import/importListExcel",
        type:"post",
        dataType : "json",
        cache: false,
        success : function(data){
            if(data.status == "success"){
                showSuccessOrErrorModal(data.msg,"success");
                $("#importModal").modal("hide");
            }else{
                showSuccessOrErrorModal(data.msg,"error");
            }
        },
        error : function(data){
            showSuccessOrErrorModal(data.msg,"error");
        }
    });
    
}


  </script>

</html>
